---
title: 商城搜索
date: 2021-04-15 17:10:26
permalink: /pages/48f9d8/
categories:
  - 内部文档
  - 发版
tags:
  - 
---
## git地址
[http://code.gome.inc/gitlab/gmsearch/gmsapp-osop-gateway](http://code.gome.inc/gitlab/gmsearch/gmsapp-osop-gateway)
> 开权限找搜索后端同事 刘丽娜 罗琼
> 注意只在分支**gmsapp-osop-gateway-web**上修改，提交的时候也只提交分支上的，不用去合主干，主干搜索组的同事会去合，前端只在这个分支上开发

## 开发
* 改的如果是前端代码，也就是gmsapp-osop-gateway\src\main\resources\src里的建议调试的时候最好用fiddler指向，如下图：下图只做参考。连接好后，每次改完先运行 webpack –p命令，再刷新浏览器查看

![/img/search-1.png](/img/search-1.png)

* 模板里的也就是gmsapp-osop-gateway\src\main\resources\templates里的，如果改动不大就直接改了发到uat上去看吧，装后端的服务很是麻烦，我没有装，如果要装只能找搜索组的后端来装了。

## 打包
* npm install webpack@1.13.3 –g
* 需装包和打包位置在： gmsapp-osop-gateway\src\main\resources\
* 先执行命令webpack –p，提交代码
* 每次发版提交代码需要更改时间

![/img/search-5.png](/img/search-5.png)

## 发版
### 测试环境
* 发版地址：[http://10.112.173.11:8090/jenkins/view/osop-gateway-UAT/](http://10.112.173.11:8090/jenkins/view/osop-gateway-UAT/)
* 账号：admin admin
![/img/search-2.png](/img/search-2.png)

**gmsapp-osop-gateway-web-BUILD**

![/img/search-3.png](/img/search-3.png)

**msapp-osop-gateway-web-DEPLOY**

![/img/search-4.png](/img/search-4.png)
> 如果有问题直接找搜索组

### 生产发版直接找搜索组，合代码也是他们

## 数据
1.	同步数据
  * [http://search.atguat.com.cn/search?question=%E6%89%8B%E6%9C%BA&pageType=bjson](http://search.atguat.com.cn/search?question=%E6%89%8B%E6%9C%BA&pageType=bjson)
  * [https://search.gome.com.cn/search?question=%E5%85%BB%E4%B9%90%E5%A4%9A&searchType=goods&search_mode=normal&reWrite=true&instock=1&pageType=bjson](https://search.gome.com.cn/search?question=%E5%85%BB%E4%B9%90%E5%A4%9A&searchType=goods&search_mode=normal&reWrite=true&instock=1&pageType=bjson)
2.	如果没有数据可以让搜索的人弄，或者想切换生产的数据也可以让搜索同事弄

## 文件位置
![/img/search-6.png](/img/search-6.png)

## 对接人
后端：刘丽娜、罗琼

## 字段
* prodInfo[i].stock库存 0：无货  1：有货 3： 预约商品不显示价格，6 ：预约商品显示价格

## 常见问题
* js和css文件不更新，可能是没有改variablie.ftl里的时间，如果改了，就是后端没有发上去，让他们去搞就行


## 起后端服务开发
> 如想要安装可以找搜索后端的同事，很是麻烦，不建议搞，搞了基本也不用，直接发测试环境看吧。以下是我2019年第一次安装的心得，有可能已经不是这样了，如果要装还是建议让后端同事帮搞

我第一次装了，重装系统后就没有装了，每次改前端都是用fiddle,改模板就直接发到uat上去看。如果想跑下面的环境可以试试
1.	每次修改完好打包，并且重启tomcat

### 本地访问的地址
1.	店铺：http://localhost:1234/search?shop=test
2.	结果页：http://localhost:1234/search?question=test
3.	三级分类：http://localhost:1234/category/cat10000070.html，如果要换数据替换一下cat10000070就可
4.	品牌：http://localhost:1234/pinpai/12LT-0.html
5.	http://localhost:1234/category/cat15985569.html?intcmp=search-1000052570-2
6. 如果在本地访问不到3级的数据，需要修改getGoods.js，请求地址加"/category" 变成：url:"/category"+pageData.ajaxURL，注意改完后一定打包一定要改回来
![/img/search-7.png](/img/search-7.png)

### 工具安装
1.	需要安装java,最好是8的版本
2.	Maven的settings.xml路径需要修改，看是否有盘，以及里面的ip地址是否对，还有maven需要安装全局变量
3.	需要运行ngix才能在本地访问
![/img/search-8.png](/img/search-8.png)
4.	修改文件，提交的则是本地，不然会提交到仓库，这两个文件不用提交到git
![/img/search-9.png](/img/search-9.png)
![/img/search-10.png](/img/search-10.png)

